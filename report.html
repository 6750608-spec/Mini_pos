<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background-color: #f3f4f6;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 30px;
    }

    h1 {
      margin-bottom: 20px;
      color: #111827;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* ===== Filter ===== */
    .filter-box {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 25px;
      background: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
      align-items: end;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .filter-group label {
        font-size: 13px;
        font-weight: 600;
        color: #4b5563;
    }

    .filter-box input,
    .filter-box select {
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      font-family: inherit;
    }

    .btn {
      padding: 10px 18px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      font-family: inherit;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s;
    }

    .btn-search {
      background-color: #3b82f6;
      color: white;
    }
    .btn-search:hover { background-color: #2563eb; }

    .btn-reset {
      background-color: #e5e7eb;
      color: #374151;
    }
    .btn-reset:hover { background-color: #d1d5db; }

    /* ===== Summary ===== */
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .summary-card {
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      border-left: 5px solid #3b82f6;
    }

    .summary-card:nth-child(2) { border-left-color: #facc15; }

    .summary-card h3 {
      margin: 0;
      font-size: 14px;
      color: #6b7280;
    }

    .summary-card p {
      margin-top: 8px;
      font-size: 24px;
      font-weight: bold;
      color: #111827;
    }

    /* ===== Table ===== */
    .table-container {
        background: #ffffff;
        border-radius: 12px;
        overflow-x: auto; /* Responsive Table */
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    th, td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid #f3f4f6;
    }

    th {
      background-color: #f9fafb;
      font-size: 14px;
      color: #374151;
      font-weight: 600;
      text-transform: uppercase;
    }

    tr:last-child td { border-bottom: none; }
    tr:hover { background-color: #f9fafb; }

    .status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
    }
    .st-waiting { background-color: #fee2e2; color: #991b1b; }
    .st-cooking { background-color: #dbeafe; color: #1e40af; }
    .st-done { background-color: #d1fae5; color: #065f46; }

    .back-btn {
      margin-top: 25px;
      display: inline-block;
      padding: 10px 16px;
      background-color: #4b5563;
      color: #ffffff;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
    }
    .back-btn:hover { background-color: #374151; }

    /* Loading */
    .loading {
        text-align: center;
        padding: 40px;
        color: #6b7280;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1><i data-feather="pie-chart"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h1>

    <div class="filter-box">
        <div class="filter-group">
            <label>‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="startDate">
        </div>
        <div class="filter-group">
            <label>‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="endDate">
        </div>
        <div class="filter-group">
            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
            <select id="statusFilter">
                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô">‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∏‡∏á">üë®‚Äçüç≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∏‡∏á</option>
            </select>
        </div>
        <div class="filter-group" style="flex-direction: row; align-self: flex-end; gap: 10px;">
            <button onclick="applyFilter()" class="btn btn-search"><i data-feather="search" width="16"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            <button onclick="resetFilter()" class="btn btn-reset"><i data-feather="rotate-ccw" width="16"></i> ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
    </div>

    <div class="summary">
      <div class="summary-card">
        <h3>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏° (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>
        <p id="totalSales">0.00 ‡∏ö‡∏≤‡∏ó</p>
      </div>
      <div class="summary-card">
        <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>
        <p id="totalOrders">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
      </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                    <th>‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
                    <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                </tr>
            </thead>
            <tbody id="reportTable">
                <tr><td colspan="5" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
            </tbody>
        </table>
    </div>
    
    <a href="index.html" class="back-btn">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  </div>

  <script>
    // URL ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö index.html
    const API_URL = "https://script.google.com/macros/s/AKfycby15QIuQ7S9NCnxS-gK63t9PkPXeBNjgVH_vwpKPdFEodyOUNFaom3bSzHcX6RaKx-pDg/exec"; 
    
    let allOrders = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤

    feather.replace();

    window.addEventListener('DOMContentLoaded', () => {
        loadData();
    });

    async function loadData() {
        try {
            const res = await fetch(`${API_URL}?action=getOrders`);
            const data = await res.json();
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            allOrders = data.map(order => {
                // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡∏∞ JSON string ‡∏Ç‡∏≠‡∏á items ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                // ‡πÅ‡∏ï‡πà API ‡∏õ‡∏Å‡∏ï‡∏¥‡∏™‡πà‡∏á string ‡∏°‡∏≤ ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ string ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô
                // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Date Object ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                return {
                    ...order,
                    dateObj: new Date(order.time), // ‡∏™‡∏°‡∏°‡∏ï‡∏¥ order.time ‡πÄ‡∏õ‡πá‡∏ô format ‡∏ó‡∏µ‡πà JS ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ
                    totalPrice: calculateOrderTotal(order.items) // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å string ‡∏´‡∏£‡∏∑‡∏≠ object
                };
            });

            renderTable(allOrders);
        } catch (error) {
            console.error(error);
            document.getElementById('reportTable').innerHTML = `<tr><td colspan="5" style="text-align:center; color:red; padding:20px;">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</td></tr>`;
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ß‡πà‡∏≤ API ‡∏™‡πà‡∏á items ‡∏°‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô)
    function calculateOrderTotal(itemsData) {
        // ‡∏Å‡∏£‡∏ì‡∏µ items ‡πÄ‡∏õ‡πá‡∏ô String ‡πÄ‡∏ä‡πà‡∏ô "‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î x 2, ‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤ x 1" (‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢)
        // ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô index.html ‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô JSON string ‡πÄ‡∏£‡∏≤‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á parse
        // ‡πÅ‡∏ï‡πà‡πÉ‡∏ô index.html ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ payload.total ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÑ‡∏´‡∏°? 
        // ‡∏ñ‡πâ‡∏≤ API ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡πá‡∏ö Total ‡πÑ‡∏ß‡πâ ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏≠‡∏á ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏î‡∏∂‡∏á Total ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ 
        // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ Total ‡∏ñ‡πâ‡∏≤ API ‡∏™‡πà‡∏á‡∏°‡∏≤ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏°‡∏≤ ‡πÄ‡∏£‡∏≤‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô - ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ Backend ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á Total ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢
        
        // *‡∏à‡∏≤‡∏Å Code index.html ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á total ‡πÑ‡∏õ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤ getOrders ‡πÑ‡∏°‡πà return total ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
        // ‡πÄ‡∏£‡∏≤‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ
        
        // ‡∏™‡∏°‡∏°‡∏ï‡∏¥: ‡∏ñ‡πâ‡∏≤ backend ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á field 'total' ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞ return 0 ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô
        // ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤ items ‡πÄ‡∏õ‡πá‡∏ô string ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≤‡∏Å
        // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ: ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏°‡∏µ field total ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
        return 0; // *‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏ß‡∏£‡πÅ‡∏Å‡πâ Google Script ‡πÉ‡∏´‡πâ return total ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏î
    }

    // ‡πÅ‡∏ï‡πà‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏Å‡πà‡∏≠‡∏ô! ‡∏à‡∏≤‡∏Å index.html ‡πÄ‡∏£‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á total ‡πÑ‡∏õ‡∏ï‡∏≠‡∏ô createOrder
    // ‡∏ú‡∏°‡∏à‡∏∞‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤ Google Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì return column ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö Total ‡∏°‡∏≤‡πÉ‡∏´‡πâ ‡∏´‡∏£‡∏∑‡∏≠ return items ‡πÄ‡∏õ‡πá‡∏ô JSON
    // ‡∏ñ‡πâ‡∏≤ items ‡πÄ‡∏õ‡πá‡∏ô String ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏¢‡∏≤‡∏Å ‡πÄ‡∏£‡∏≤‡∏à‡∏∞ render ‡∏ï‡∏≤‡∏°‡∏°‡∏µ‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏¥‡∏î
    // *** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå ‡∏ú‡∏°‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô logic render ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡πà‡∏≠‡∏ô ***

    function renderTable(data) {
        const table = document.getElementById('reportTable');
        
        if(data.length === 0) {
            table.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
            updateSummary(0, 0);
            return;
        }

        let sumSales = 0;

        table.innerHTML = data.map(item => {
            // Logic ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤: 
            // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô Code ‡∏ù‡∏±‡πà‡∏á Server ‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á field ‡πÑ‡∏´‡∏ô‡∏°‡∏≤‡∏ö‡πâ‡∏≤‡∏á
            // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å property ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠ parse ‡∏à‡∏≤‡∏Å items
            
            // *hack* ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° extract ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏≤‡∏Å string ‡∏ñ‡πâ‡∏≤ server ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á total ‡∏°‡∏≤
            // ‡πÅ‡∏ï‡πà‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏ß‡∏£‡∏™‡πà‡∏á total ‡∏°‡∏≤ ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ item.total ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            let price = item.total ? parseFloat(item.total) : 0; 
            
            sumSales += price;

            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            let statusClass = "st-waiting";
            if(item.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∏‡∏á") statusClass = "st-cooking";
            if(item.status === "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô") statusClass = "st-done";

            return `
            <tr>
                <td>
                    <div style="font-weight:bold;">${new Date(item.time).toLocaleDateString('th-TH')}</div>
                    <div style="font-size:12px; color:#6b7280;">${new Date(item.time).toLocaleTimeString('th-TH')}</div>
                </td>
                <td>${item.orderNumber}</td>
                <td style="max-width:300px;">
                    <div style="font-size:14px;">${item.items}</div>
                    <div style="font-size:12px; color:#6b7280;">‡πÇ‡∏ï‡πä‡∏∞: ${item.tableName} | ‡∏ä‡∏∑‡πà‡∏≠: ${item.buyerName}</div>
                </td>
                <td><span class="status-badge ${statusClass}">${item.status}</span></td>
                <td style="font-weight:bold; color:#2563eb;">${price > 0 ? price.toLocaleString() : '-'} ‡∏ø</td>
            </tr>`;
        }).join('');

        updateSummary(sumSales, data.length);
        feather.replace();
    }

    function updateSummary(sales, orders) {
        document.getElementById('totalSales').innerText = sales.toLocaleString(undefined, {minimumFractionDigits: 2}) + ' ‡∏ö‡∏≤‡∏ó';
        document.getElementById('totalOrders').innerText = orders + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
    }

    function applyFilter() {
        const start = document.getElementById('startDate').value;
        const end = document.getElementById('endDate').value;
        const status = document.getElementById('statusFilter').value;

        let filtered = allOrders.filter(item => {
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
            const itemDate = new Date(item.time).toISOString().split('T')[0];
            
            const isAfterStart = !start || itemDate >= start;
            const isBeforeEnd = !end || itemDate <= end;
            const isStatusMatch = status === 'all' || item.status === status;

            return isAfterStart && isBeforeEnd && isStatusMatch;
        });

        renderTable(filtered);
    }

    function resetFilter() {
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        document.getElementById('statusFilter').value = 'all';
        renderTable(allOrders);
    }
  </script>

</body>
</html>
